---
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    chakra: libs/remark-latest.min.js
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---
class: middle, center
background-image: url(img/capa3.png)
background-size: cover

---
class: middle, right
background-image: url(img/espera.gif)
background-position: left
background-size: contain

## Começamos em ...

.pull-right[
```{r, echo=FALSE}
countdown::countdown(
  minutes = 5, 
  seconds = 30, 
#  left = 0, right = 0,
  play_sound = TRUE,
  padding = "50px", 
#  margin = "20%",
  font_size = "4em"
)
```
]

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1F487E", #"#061A40",
  secondary_color = "#E98A15",
  inverse_header_color = "#FFFFFF"
)
```

```{r xaringanExtra, echo=FALSE}
xaringanExtra::use_tile_view()   # para overview
xaringanExtra::use_scribble()    # para fazer anotações
xaringanExtra::use_panelset()    # para abas
xaringanExtra::use_clipboard()   # botão para copiar código
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
xaringanExtra::use_progress_bar(color = "#0051BA", location = "top")
```

---
class: middle, left
background-image: url(img/check-list.gif)
background-position: right
background-size: contain

## O que veremos hoje?

- Pacotes e funções para Web Scraping;
- Ética no Web Scraping
- Praticando o que aprendemos ...

---
## Panorama do Tabalho

```{r, echo=FALSE, fig.align='center'}
knitr::include_graphics("img/ideia-raspagem.png")
```

---
## Relembrando o rvest

.panelset[

.panel[.panel-name[`read_html()`]

- Faz a leitura do site!
- Estrutura: `rvest::read_html("url-do-site")`

```{r}
rvest::read_html("https://git.io/JMTRO")
```
.pull-left[
- Forma indireta:

```{r}
# prepara url -------------------------
url_teste <- "https://git.io/JMTRO"

# salva a leitura do site -------------
site_teste <- rvest::read_html(url_teste)
```

]

.pull-right[
- Se ocorrer erro de certificação

```{r, eval=FALSE}
site_teste <- url |> 
  httr::GET(httr::config(ssl_verifypeer = FALSE)) |> 
  rvest::read_html()
```


]

]
.panel[.panel-name[`html_elements()`]

.pull-left[
- Seleciona os elementos HTML ou CSS associados.
- Use o SelectorGadget para auxiliar na escolha do CSS em questão
- A escolha adequada do elemento CSS pode reduzir o tempo de processamento e 
aliviar a memória de sua máquina!
- Sempre verifique se a extração ocorreu como desejada!


```{r}
site_teste |> 
  rvest::html_elements("a")
```
]

.pull-right[
nome          | descrição
-----------   | ----------
`h1` ... `h6` | seções
`p`           | parágrafo
`a`           | hyperlinks
`table`       | tabela
`ol`; `ul`    | listas
`li`          | item de lista
`b`           | negrito
`i`           | itálico

]

]
.panel[.panel-name[`html_attr()`]

- Seleciona o atributo associado a alguma _tag_
- Em nosso caso, um atributo associado à _tag_ `a` é a **referência do hyperlink**,
chamada `href`
  + ela possui um "nome" e um "valor"
  + desejamos extrair o "valor", geralmente

```{r, eval=FALSE}
site_teste |> 
  rvest::html_elements("a") |> 
  rvest::html_attr("href")
```

```{r, eval=FALSE}
https://www.mathunion.org/
https://sbm.org.br/
https://www.sbmac.org.br/
```

]
.panel[.panel-name[`html_text2()`]
- Seleciona o texto associado à _tag_, eliminando os espaços em branco, sempre que
possível.

```{r, eval=FALSE}
site_teste |> 
  rvest::html_elements("a") |> 
  rvest::html_text2()
```

```{r, eval=FALSE}
[1] "União Internaciional de Matemática (IMU)"                           
[2] "Sociedade Brasileira de Matemática (SBM)"                           
[3] "Sociedade Brasileira de Matemática Aplicada e Computacional (SBMAC)"
```


]
.panel[.panel-name[`html_table()`]
- Extrai uma tabela específica, se indicado o CSS;
- Extrai TODAS as tabelas, armazenando-as numa lista; se não indicado o CSS
- Se houver cabeçalho, usamos o argumento: `header = TRUE`

```{r}
site_teste |> 
  rvest::html_table(header = TRUE)
```

]
]

--- 
## Conhecendo o stringr

.panelset[

.panel[.panel0-name[]
]
.panel[.panel0-name[]
]
.panel[.panel0-name[]
]
.panel[.panel0-name[]
]
.panel[.panel0-name[]
]

]


---
## Resumo dos pacotes que usaremos

função | descrição
------ | ----------
`readr::parse_double()` | converte caracteres em classe numérica
`readr::write_csv(variavel, "caminho/nome.csv")` | forma um csv
`dplyr::if_else(cond., caso-verdade, caso-contrário)` | estabelece condicional numa tibble
`stringr::subset()` | seleciona um padrão, dentre os fraguementos
`stringr::str_sub(string, start = ..., end = ...)` | de onde começar a extrair em cada linha
`stringr::str_replace_all(string, "padrão", "subs.")` | substitui tudo em algum padrão
`stringr::str_to_lower()` | torna tudo em minúsculas
`stringr::str_trim()` | retira os espaços em brancos
`stringi::stri_trans_general(nome_doido, "Latin-ASCII")` | retira toda acentuação
`lubridate::dmy(possiveis_datas)` | converte em data (dd/mm/aa)
`purrr::map_df(x, funcao)` | para iteração com tibbles

<!---------------------------------------------------------------------------->
---
class: center, middle

# Obrigado!

</br>
Slides criados com </br> [`xaringan`](https://github.com/yihui/xaringan) e [`xaringanthemer`](https://github.com/gadenbuie/xaringanthemer).

</br>
</br>
</br>
<img src="img/rodape.png" width=600>
